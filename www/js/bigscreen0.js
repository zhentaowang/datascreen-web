/*! longteng (c) 2016 
	Author: Renzhao
*/
function getMinuteData(time){var formData=User.appendAccessToken({date:time});console.log("timer:"+time),$.ajax({url:server+"getCustomDataCount",type:"POST",data:JSON.stringify(formData),success:function(e){vm.personNumber=e.count,console.log("personNumber:"+vm.personNumber)}}),$.ajax({url:server+"getDragonCardCount",type:"POST",data:JSON.stringify(formData),success:function(e){vm.vipNumber=e.count,console.log("vipNumber:"+vm.vipNumber)}}),$.ajax({url:server+"custom/lounge/portrait",type:"post",dataType:"json",timeout:6e4,async:!1,data:JSON.stringify(formData),success:function(data){if(null!=data.trafficsite){console.log("get data success");var objArray=eval(data.trafficsite);for(var i in objArray){var airportName=objArray[i].name,values=objArray[i].value,num=values[2];values.pop(),values[1]<=90&&(geoCoordMap[airportName]=values,rawData.push([airportName,num]))}}},error:function(){alert("ajax error")}})}function makeMapData(e){for(var a=[],t=0;t<e.length;t++){var r=geoCoordMap[e[t][0]];r&&a.push({name:e[t][0],value:r.concat(e[t].slice(1))})}return a}function makeParallelAxis(e){for(var a=[],t=1;t<e.length;t++)a.push({dim:t,name:e[t]});return a}function getPersonNum(e){for(var a=0;a<rawData.length;a++){var t=rawData[a];if(t[0]==e)return t[1]}}User.isLogin()||(document.location.href="login.html");var dom=document.getElementById("container"),myChart=echarts.init(dom),app={};option=null;var geoCoordMap={},rawData=new Array,vm=new Vue({el:"body",data:{vipNumber:"",personNumber:""}});getMinuteData((new Date).getTime()-1728e5),function(){function e(){var e=new Date((new Date).getTime()-1728e5);vm.time=getLocalDay(e)+" "+getLocalTime(e),0===e.getSeconds()&&getMinuteData(e.getTime())}var a;a=setInterval(e,1e3),$(".start-pause").click(function(){var t=$(".pause").hasClass("start");t?($(".pause").removeClass("start"),a=setInterval(e,1e3)):($(".pause").addClass("start"),clearInterval(a))})}(),option={backgroundColor:new echarts.graphic.RadialGradient(.5,.5,.4,[{offset:0,color:"#14296d"},{offset:1,color:"#14296d"}]),title:{text:"",subtext:"",sublink:"",left:"center",top:5,itemGap:0,textStyle:{color:"#fff"}},tooltip:{trigger:"item",formatter:function(e){var a=(e.value+"").split(".");return a=a[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,")+"."+a[1],e.name+"<br/>使用人次："+getPersonNum(e.name)}},toolbox:{show:!0,left:"right",iconStyle:{normal:{borderColor:"#ddd"}},feature:{}},geo:{show:"true",map:"world",silent:!0,label:{emphasis:{show:!0,areaColor:"#eee"}},itemStyle:{normal:{borderWidth:.2,borderColor:"#404a59",areaColor:"#8fafcc"}},selectedMode:"single",left:"1%",top:150,bottom:"20%",right:"1%",roam:!1,scaleLimit:{min:.85,max:5}},series:[{name:"",type:"scatter",coordinateSystem:"geo",symbol:"circle",data:makeMapData(rawData),activeOpacity:1,hoverAnimation:!0,label:{emphasis:{formatter:"{b}",position:"right",show:!1},emphasis:{show:!0}},symbolSize:function(e){return e[2]<100?8:e[2]<300?13:15+e[2]/30},itemStyle:{normal:{borderColor:"#fff",color:"#8ef82e"}}}]},option&&"object"==typeof option&&myChart.setOption(option,!0);