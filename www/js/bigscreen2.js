/*! longteng (c) 2016 
	Author: Renzhao
*/
function getMinuteData(e){var t=User.appendAccessToken({date:e});$.ajax({url:server+"getAppMembershipNumber",type:"POST",data:JSON.stringify(t),success:function(e){vm.personNumber=e.count}}),$.ajax({url:server+"getAppYearOrder",type:"POST",data:JSON.stringify(t),success:function(e){vm.orderNumber=e.count}})}function getNowData(){var e=User.appendAccessToken({date:(new Date).getTime()-1728e5});$.ajax({url:server+"getAppDownloadCount",type:"POST",data:JSON.stringify(e),success:function(e){vm.appNumber=e.count}}),$.ajax({url:server+"getAppUserDate",type:"POST",data:JSON.stringify(e),success:function(e){var t=e.data.map(function(e){return getYueRi(new Date(e.statistic_date))}),a=e.data.map(function(e){return e.add_user}),n=e.data.map(function(e){return e.active_user});lineChart(a,"appAdd",t),lineChart(n,"appActive",t)}}),$.ajax({url:server+"getAppOrderEvolutionDate",type:"POST",data:JSON.stringify(e),success:function(e){lineChart(e.carbillData,"carbillData"),lineChart(e.chennelbill,"chennelbill"),lineChart(e.flash,"flash"),lineChart(e.cip,"cip"),lineChart(e.ecom2gMealTicketData,"ecom2gMealTicketData"),lineChart(e.membershipData,"membershipData"),lineChart(e.loungeData,"loungeData"),lineChart(e.lounge_service,"lounge_service")}}),$.ajax({url:server+"getHotProductDate",type:"POST",data:JSON.stringify(e),success:function(e){wordCloud(e.hot_lounge,"wordCloud1"),wordCloud(e.hot_restaurant,"wordCloud2")}})}function wordCloud(e,t){e=e.sort(function(e,t){return t.value-e.value}),console.log(e);var a=echarts.init(document.getElementById(t)),n={series:[{type:"wordCloud",shape:"circle",left:"center",top:"center",width:"70%",height:"80%",right:null,bottom:null,sizeRange:[12,60],rotationRange:[-90,90],rotationStep:45,gridSize:8,textStyle:{normal:{fontFamily:"Microsoft YaHei",color:function(e){return"rgb("+[Math.round(49*Math.random()+24),Math.round(160*Math.random()+95),Math.round(68*Math.random()+187)].join(",")+")"}},emphasis:{shadowBlur:10,shadowColor:"#333"}},data:e}]};a.setOption(n)}function lineChart(e,t,a){a||(a=e.map(function(e){return getYueRi(new Date(e.order_date))}),e=e.map(function(e){return e.order_num}));var n=echarts.init(document.getElementById(t),"macarons"),r={tooltip:{trigger:"axis"},backgroundColor:"#0a284e",color:["#fa836d","#a6d25f"],grid:{left:"3%",right:"4%",bottom:"3%",top:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}},data:a},yAxis:{type:"value",axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}},splitLine:{show:!1}},series:[{name:"数量",type:"line",smooth:!0,markPoint:{data:[{name:"",value:e[e.length-1],xAxis:e.length-1,yAxis:e[e.length-1],symbolOffset:[0,20]}]},data:e}]};n.setOption(r,!0)}User.isLogin()||(document.location.href="login.html");var vm=new Vue({el:"body",data:{appNumber:"",personNumber:"",orderNumber:"",time:""}});getNowData(),getMinuteData((new Date).getTime()-1728e5),function(){function e(){var e=new Date((new Date).getTime()-1728e5);vm.time=getLocalDay(e)+" "+getLocalTime(e),4===e.getHours()&&e.getMinutes()===e.getSeconds()===0&&getDayData(),0===e.getSeconds()&&getMinuteData(e.getTime())}var t;t=setInterval(e,1e3)}();