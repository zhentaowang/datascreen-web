/*! longteng (c) 2016 
	Author: Renzhao
*/
function getMinuteData(t){var e=User.appendAccessToken({date:t});$.ajax({url:server+"custom/lounge/portrait",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),success:function(t){worldMap(t.trafficsite),getRestInfo(t.continentTrafficSite)}}),$.ajax({url:server+"getDragonCardCount",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),success:function(t){getNumber(t.count,"cardNumber")}}),$.ajax({url:server+"getDragonCardCustomCount",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),success:function(t){getNumber(t.count,"personNumber")}})}function getDayData(){var t=User.appendAccessToken({date:new Date("2016-12-6 "+(new Date).toTimeString()).getTime()});$.ajax({url:server+"evolutionDate",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),success:function(t){getEvolutionMonth(t),getEvolutionDay(t)}}),$.ajax({url:server+"dragonCardConsumeDateAgency",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),success:function(t){getAgency(t)}}),$.ajax({url:server+"getAppOrderEvolutionDate",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),success:function(t){fourCharts1(t),fourCharts2(t),fourCharts3(t),fourCharts4(t)}})}function fourCharts1(t){var e=t.date[0].data.map(function(t){return getYueRi(new Date(t.date))}),a=t.date[0].data.map(function(t){return t.data.annual_card_order_num}),n=t.date[0].data.map(function(t){return t.data.point_charge_order_num}),o=t.date[0].data.map(function(t){return t.data.give_point_order_num}),r=t.date[0].data.map(function(t){return t.data.lounge_service_order_num}),i=echarts.init(document.getElementById("chart1"),"macarons"),l={title:{text:"日订单数",textStyle:{color:"#fff",fontSize:14,fontWeight:"normal"},x:"center",bottom:5},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},color:["#ff8162","#9bc865","#ffda5e","#69c2e0"],legend:{textStyle:{color:"#fff"},top:20,data:["8点/年卡","点数充值","赠点","休息室服务"]},grid:{left:"3%",right:"4%",bottom:"13%",containLabel:!0},xAxis:[{type:"category",axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}},data:e}],yAxis:[{type:"value",axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}}}],series:[{name:"8点/年卡",type:"line",data:a},{name:"点数充值",type:"line",data:n},{name:"赠点",type:"line",data:o},{name:"休息室服务",type:"line",data:r}]};i.setOption(l,!0)}function fourCharts2(t){var e=t.month[0].data.map(function(t){return t.date}),a=t.month[0].data.map(function(t){return t.data.annual_card_order_num}),n=t.month[0].data.map(function(t){return t.data.point_charge_order_num}),o=t.month[0].data.map(function(t){return t.data.give_point_order_num}),r=t.month[0].data.map(function(t){return t.data.lounge_service_order_num}),i=echarts.init(document.getElementById("chart2"),"macarons"),l={title:{text:"月累计订单数",textStyle:{color:"#fff",fontSize:14,fontWeight:"normal"},x:"center",bottom:5},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},color:["#ff8162","#9bc865","#ffda5e","#69c2e0"],legend:{textStyle:{color:"#fff"},top:20,data:["8点/年卡","点数充值","赠点","休息室服务"]},grid:{left:"3%",right:"4%",bottom:"13%",containLabel:!0},xAxis:[{type:"category",axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}},data:e}],yAxis:[{type:"value",axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}}}],series:[{name:"8点/年卡",type:"line",data:a},{name:"点数充值",type:"line",data:n},{name:"赠点",type:"line",data:o},{name:"休息室服务",type:"line",data:r}]};i.setOption(l,!0)}function fourCharts3(t){var e=t.date[0].data.map(function(t){return getYueRi(new Date(t.date))}),a=t.date[0].data.map(function(t){return t.data.annual_card_amount_num}),n=t.date[0].data.map(function(t){return t.data.point_charge_amount_num}),o=t.date[0].data.map(function(t){return t.data.give_point_amount_num}),r=t.date[0].data.map(function(t){return t.data.lounge_service_amount_num}),i=echarts.init(document.getElementById("chart3"),"macarons"),l={title:{text:"日金额",textStyle:{color:"#fff",fontSize:14,fontWeight:"normal"},x:"center",bottom:5},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},color:["#ff8162","#9bc865","#ffda5e","#69c2e0"],legend:{textStyle:{color:"#fff"},top:20,data:["8点/年卡","点数充值","赠点","休息室服务"]},grid:{left:"3%",right:"4%",bottom:"13%",containLabel:!0},xAxis:[{type:"category",axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}},data:e}],yAxis:[{type:"value",axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}}}],series:[{name:"8点/年卡",type:"line",data:a},{name:"点数充值",type:"line",data:n},{name:"赠点",type:"line",data:o},{name:"休息室服务",type:"line",data:r}]};i.setOption(l,!0)}function fourCharts4(t){var e=t.month[0].data.map(function(t){return t.date}),a=t.month[0].data.map(function(t){return t.data.annual_card_amount_num}),n=t.month[0].data.map(function(t){return t.data.point_charge_amount_num}),o=t.month[0].data.map(function(t){return t.data.give_point_amount_num}),r=t.month[0].data.map(function(t){return t.data.lounge_service_amount_num}),i=echarts.init(document.getElementById("chart4"),"macarons"),l={title:{text:"月累计金额",textStyle:{color:"#fff",fontSize:14,fontWeight:"normal"},x:"center",bottom:5},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},color:["#ff8162","#9bc865","#ffda5e","#69c2e0"],legend:{textStyle:{color:"#fff"},top:20,data:["8点/年卡","点数充值","赠点","休息室服务"]},grid:{left:"3%",right:"4%",bottom:"13%",containLabel:!0},xAxis:[{type:"category",axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}},data:e}],yAxis:[{type:"value",axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}}}],series:[{name:"8点/年卡",type:"line",data:a},{name:"点数充值",type:"line",data:n},{name:"赠点",type:"line",data:o},{name:"休息室服务",type:"line",data:r}]};i.setOption(l,!0)}function getTenData(){function t(t){var e=t.data.map(function(t){return getYueRi(new Date(t.statistic_date))}),a=t.data.map(function(t){return t.active_user}),n=t.data.map(function(t){return t.add_user}),o=echarts.init(document.getElementById("appUser"),"macarons"),r={tooltip:{trigger:"axis"},color:["#ff8162","#9bc865"],legend:{top:20,textStyle:{color:"#fff"},data:["活跃用户","新增用户"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}},data:e},yAxis:{type:"value",axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}}},series:[{name:"活跃用户",type:"line",areaStyle:{normal:{}},data:a},{name:"新增用户",type:"line",areaStyle:{normal:{}},data:n}]};o.setOption(r,!0)}var e=User.appendAccessToken({date:new Date("2016-10-10").getTime()});$.ajax({url:server+"getAppUserDate",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),success:function(e){t(e)}})}function getNumber(t,e){var a=formatNumber(t),n=a.split("");numberList=n.map(function(t){return","==t?{name:t,type:"point"}:{name:t,type:"num"}}),"cardNumber"==e?vm.cardNumber=numberList:vm.personNumber=numberList}function getAgency(t){vm.agency=t}function getRestInfo(t){t.forEach(function(t){t.data.forEach(function(t){1===t.increase?t.type="up":(t.type="down",t.style={transform:"rotate(180deg)"})})}),vm.rest=t}function startFade(t,e){function a(t){r.eq(t).stop(!0,!1).animate({opacity:"1"},300).siblings().stop(!0,!1).animate({opacity:"0"},300),o.eq(t).addClass("active").siblings().removeClass("active")}var n,o=t.children(".nav").children("li"),r=t.children(".content").children("li"),i=r.length,l=(t.width,0);clearInterval(n),e&&t.hover(function(){clearInterval(n)},function(){n=setInterval(function(){a(l),l++,l==i&&(l=0)},1e4)}).trigger("mouseleave"),o.click(function(){$(this).addClass("active").siblings().removeClass("active");var t=o.index(this);a(t)})}function getEvolutionMonth(t){var e=t.monthNum.map(function(t){return t.date}),a=t.monthNum.map(function(t){return t.cardNum}),n=t.monthNum.map(function(t){return t.consumeNum}),o=echarts.init(document.getElementById("evolutionMonth"),"macarons"),r={tooltip:{trigger:"axis"},color:["#fa836d","#a6d25f"],legend:{textStyle:{color:"#fff"},data:["开卡数","休息室使用人次"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}},data:e},yAxis:{type:"value",axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}}},series:[{name:"开卡数",type:"line",data:a},{name:"休息室使用人次",type:"line",data:n}]};o.setOption(r,!0)}function getEvolutionDay(t){var e=t.dayNum.map(function(t){return getLocalDay(new Date(t.date))}),a=t.dayNum.map(function(t){return t.cardNum}),n=t.dayNum.map(function(t){return t.consumeNum}),o=echarts.init(document.getElementById("evolutionDay"),"macarons"),r={tooltip:{trigger:"axis"},legend:{textStyle:{color:"#fff"},data:["开卡数","休息室使用人次"]},color:["#fa836d","#a6d25f"],grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}},data:e},yAxis:{type:"value",axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}}},series:[{name:"开卡数",type:"line",data:a},{name:"休息室使用人次",type:"line",data:n}]};o.setOption(r,!0)}function worldMap(t){var e=echarts.init(document.getElementById("charts"),"macarons"),a={title:{text:"",left:"center",textStyle:{color:"#fff"}},tooltip:{trigger:"item"},geo:{map:"world",label:{emphasis:{show:!1}},roam:!0,itemStyle:{normal:{areaColor:"#3279a0",borderColor:"#3279a0"},emphasis:{areaColor:"#05c8f2"}}},series:[{name:"休息室人数",type:"scatter",coordinateSystem:"geo",data:t,symbolSize:function(t){return Math.log(t[2])},label:{normal:{formatter:"{b}",position:"right",show:!1},emphasis:{show:!0}},itemStyle:{normal:{color:"#7eff00",shadowBlur:1,shadowColor:"#fff"}}},{name:"Top 5",type:"effectScatter",coordinateSystem:"geo",data:t.sort(function(t,e){return e.value[2]-t.value[2]}).slice(0,5),symbolSize:function(t){return Math.log(t[2])},showEffectOn:"render",rippleEffect:{brushType:"stroke"},hoverAnimation:!0,label:{normal:{formatter:"{b}",position:"right",show:!0}},itemStyle:{normal:{color:"#7eff00",shadowBlur:10,shadowColor:"#333"}},zlevel:1}]};e.setOption(a,!0)}User.isLogin()||(document.location.href="login.html");var vm=new Vue({el:"body",data:{cardNumber:"",personNumber:"",time:"",rest:"",agency:""}});startFade($("#leftFade"),!0),startFade($("#rightFade"),!0),startFade($("#bottomFade")),getDayData(),getTenData(),getMinuteData(new Date("2016-12-6 "+(new Date).toTimeString()).getTime()),function(){function t(){var t=new Date("2016-12-6 "+(new Date).toTimeString());vm.time=getLocalDay(t)+" "+getLocalTime(t),4===t.getHours()&&t.getMinutes()===t.getSeconds()===0&&getDayData(),0===t.getSeconds()&&getMinuteData(t.getTime())}var e;e=setInterval(t,1e3),$(".start-pause").click(function(){var a=$(".pause").hasClass("start");a?($(".pause").removeClass("start"),e=setInterval(t,1e3)):($(".pause").addClass("start"),clearInterval(e))})}();