/*! longteng (c) 2016 
	Author: Renzhao
*/
function getPortrait(e,t){console.log(e);var a=User.appendAccessToken({data:e,portrait_type:t?[t]:null});$.ajax({url:server+"user/portrait",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(a),dataType:"json",success:function(e){0===e.status?t?(userChart(e.user.data),vm.portraitShow=!0):(drawChart1(e.user.dragoncard_bank),drawChart2(e.user.lounge_consume_count),drawChart3(e.user.sex_type),drawChart4(e.user.generation),drawChartMap(e.user.mobile_phone_location_province)):vm.portraitShow=!1}})}function userChart(e){var t=e.map(function(e){return e.name}),a=e.map(function(e){return parseInt(e.value)}),o=echarts.init(document.getElementById("userChart"),"macarons"),r={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} "},grid:{left:"3%",right:"4%",bottom:"25%",containLabel:!0},xAxis:[{type:"category",axisLabel:{textStyle:{color:"#fff"},interval:0,rotate:30},axisLine:{lineStyle:{color:"#fff"}},data:t}],yAxis:[{type:"value",axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}},splitLine:{show:!1}}],series:[{name:"用户个数",type:"bar",barMaxWidth:150,itemStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#007fff"},{offset:1,color:"#043266"}])},emphasis:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#2378f7"},{offset:.7,color:"#2378f7"},{offset:1,color:"#83bff6"}])}},data:a}]};o.setOption(r,!0)}function getTags(){vm.userTags=tagType(data.user_tags),vm.cardTags=tagType(data.user_dragoncard_tags),vm.appTags=tagType(data.app_feature_tags),vm.restTags=tagType(data.vvip_feature_tags)}function getEBTags(){var e=User.appendAccessToken({data:{}});$.ajax({url:server+"user/portrait/ecom_tags",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),dataType:"json",success:function(e){vm.carbill=tagType(e.e_commerce_carbill),vm.channelbill=tagType(e.e_commerce_channelbill),vm.parking=tagType(e.e_commerce_parking),vm.cip=tagType(e.e_commerce_cip),vm.restaurant=tagType(e.e_commerce_restaurant),vm.lounge_service=tagType(e.e_commerce_lounge_service),vm.membership=tagType(e.e_commerce_membership),vm.lounge=tagType(e.e_commerce_lounge),vm.give_point=tagType(e.e_commerce_give_point),vm.promotion=tagType(e.e_commerce_promotion)}})}function getOptions(){vm.options=dataKey.portrait_type,vm.tagsMap={},dataKey.portrait_type.forEach(function(e){e.children.forEach(function(e){e.children?e.children.forEach(function(e){vm.tagsMap[e.type]=e.name}):vm.tagsMap[e.type]=e.name})}),vm.options.forEach(function(e){for(var t=0;t<e.children.length;t++)switch(e.children[t].type){case"dragoncard_register_time":case"dragoncard_register_year":case"app_register_time":case"lastest_consume_date_for_in_range":case"lastest_consume_date_for_not_in_range":e.children.removeElem(e.children[t]),t--}}),vm.tagsShow=!0}function getUserList(e,t){var a=User.appendAccessToken({data:e});$.ajax({url:server+"user/portrait/userList",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(a),dataType:"json",success:function(e){0===e.status?(vm.userCount=e.total,cacheData.set("user_list",e.userList),vm.portraitAllShow=!0,vm.noUserShow=!1,t()):vm.noUserShow=!0}})}function drawChart1(e){e=e.sort(function(e,t){return t.value-e.value});var t=echarts.init(document.getElementById("chart1"),"macarons"),a={backgroundColor:"#0a274d",legend:{orient:"vertical",left:"left",padding:10,itemWidth:10,itemHeight:10,textStyle:{color:"#fff"},data:e.map(function(e){return e.name})},color:["#007ffe","#fe8463","#c3e641","#47d6e0","#9d466b","#fad860"],tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{name:"银行个数",type:"pie",center:["60%","50%"],label:{normal:{show:!1}},data:e}]};t.setOption(a,!0)}function drawChart2(e){var t=echarts.init(document.getElementById("chart2"),"macarons"),a={backgroundColor:"#0a274d",grid:{left:"3%",right:"4%",bottom:"12%",top:"5%",containLabel:!0},xAxis:{type:"category",data:e.map(function(e){return e.name}),axisLabel:{interval:0,rotate:30,textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}}},yAxis:{type:"value",axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}},splitLine:{show:!1}},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} "},series:[{name:"用户个数",type:"bar",barMaxWidth:25,itemStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#007fff"},{offset:1,color:"#043266"}])},emphasis:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#2378f7"},{offset:.7,color:"#2378f7"},{offset:1,color:"#83bff6"}])}},data:e}]};t.setOption(a,!0)}function drawChart3(e){var t=echarts.init(document.getElementById("chart3"),"macarons"),a={backgroundColor:"#0a274d",color:["#007ffe","#fe8463","#c3e641","#47d6e0","#9d466b"],tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{name:"用户个数",type:"pie",data:e}]};t.setOption(a,!0)}function drawChart4(e){var t=echarts.init(document.getElementById("chart4"),"macarons"),a={backgroundColor:"#0a274d",grid:{left:"3%",right:"4%",bottom:"2%",top:"5%",containLabel:!0},xAxis:{type:"category",data:e.map(function(e){return e.name}),axisLabel:{interval:0,textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}}},yAxis:{type:"value",axisLabel:{textStyle:{color:"#fff"}},axisLine:{lineStyle:{color:"#fff"}},splitLine:{show:!1}},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} "},series:[{name:"用户个数",type:"bar",barMaxWidth:25,itemStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#007fff"},{offset:1,color:"#043266"}])},emphasis:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#2378f7"},{offset:.7,color:"#2378f7"},{offset:1,color:"#83bff6"}])}},data:e}]};t.setOption(a,!0)}function drawChartMap(e){var t=e.map(function(e){return~~e.value}),a=echarts.init(document.getElementById("chinaMap"),"macarons"),o={tooltip:{trigger:"item",formatter:"{b} : {c}"},dataRange:{x:"right",y:260,min:0,max:Math.max.apply(null,t),text:["High","Low"],calculable:!0,textStyle:{color:"#00ccff"},inRange:{color:["#6f95bb","#70bc7d","#e0d37a","#fe8463"]}},series:[{name:"中国",type:"map",mapType:"china",itemStyle:{normal:{areaColor:"#6f95bb",borderColor:"#42c0e4",areaStyle:{color:"#3a434f"}},emphasis:{label:{show:!0,textStyle:{color:"#fff"}},areaStyle:{color:"#9fb156"}}},label:{normal:{show:!1,textStyle:{color:"#fff"}},emphasis:{show:!0}},data:e}]};a.setOption(o,!0)}User.isLogin()||(document.location.href="login.html");var vm=new Vue({el:"body",data:{chooseList:[],tagsMap:"",userTags:"",cardTags:"",appTags:"",restTags:"",acountTags:"",ebTags:"",carbill:"",channelbill:"",parking:"",cip:"",restaurant:"",lounge_service:"",membership:"",lounge:"",give_point:"",promotion:"",istoggle:!0,req:{},userCount:0,userList:"",option1:0,options:"",subOption:"",option2:0,thrOption:"",thrName:0,tagsShow:!1,portraitShow:!1,portraitAllShow:!1,listShow:!1,willShow:!0,noUserShow:!1},methods:{toggle:function(){vm.istoggle?vm.istoggle=!1:vm.istoggle=!0},logout:function(){User.logout(),document.location.href="login.html"},clear:function(){vm.chooseList=[],vm.req={},vm.portraitShow=!1,vm.listShow=!1,vm.portraitAllShow=!1,getTags(),getEBTags()},choose:function(e){e.display_name=e.name+"--"+vm.tagsMap[e.type],e.selected?(e.selected=!1,vm.chooseList.removeElem(e)):(e.selected=!0,vm.chooseList.push(e)),0!=vm.chooseList.length&&(vm.req={},vm.chooseList.forEach(function(e){var t=e.type;vm.req[t]?vm.req[t].push(e.id):(vm.req[t]=[],vm.req[t].push(e.id)),vm.req[t]=unique(vm.req[t])}),getUserList(vm.req,function(){getPortrait(vm.req)})),vm.portraitShow=!1,vm.listShow=!1,vm.portraitAllShow=!1},click:function(){if(vm.willShow){if(!vm.option2||0==vm.option2)return void alert("请正确选择");getPortrait(vm.req,vm.option2)}else{if(!vm.thrName||0==vm.thrName)return void alert("请正确选择");getPortrait(vm.req,vm.thrName)}},change:function(){vm.option2=0,vm.thrName=0,"电商消费特征"==vm.option1?vm.willShow=!1:vm.willShow=!0,vm.options.forEach(function(e){vm.option1==e.name&&(vm.subOption=e.children,console.log(e.children))})},change2:function(){vm.subOption.forEach(function(e){vm.option2==e.name&&(vm.thrOption=e.children)})}}});getTags(),getOptions(),function(){$(".tabs-nav li").click(function(){$(this).addClass("active").siblings().removeClass("active");var e=$(".tabs-nav li").index(this);5==e?($(".tabs-nav1").show(),$(".tabs-content").css("padding","0px"),$(".tags-tabs .tabs-nav").css("borderBottom","none")):($(".tabs-nav1").hide(),$(".tabs-content").css("padding","25px"),$(".tags-tabs .tabs-nav").css("borderBottom","1px solid #045ea3")),$(".tabs-content .item").eq(e).show().siblings().hide()}),$(".tabs-nav1 li").click(function(){$(this).addClass("active").siblings().removeClass("active");var e=$(".tabs-nav1 li").index(this);$(".tabs-content .item1").eq(e).show().siblings().hide(),$(".tabs-nav1").show()})}();